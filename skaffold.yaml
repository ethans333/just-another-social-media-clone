apiVersion: skaffold/v4beta13
kind: Config
metadata:
  name: jasmc-app
build:
  local:
    push: false
  tagPolicy:
    envTemplate:
      template: latest
  artifacts:
    - image: ${FRONTEND_IMAGE_NAME}
      context: ./frontend
      docker:
        dockerfile: Dockerfile
    - image: ${BACKEND_IMAGE_NAME}
      context: ./backend
      docker:
        dockerfile: Dockerfile
deploy:
  helm:
    releases:
      - name: jasmc
        chartPath: ./charts/jasmc/
        setValueTemplates:
          image.frontend.repository: "{{.IMAGE_NAME_frontend}}"
          image.frontend.tag: "{{.IMAGE_TAG_frontend}}"
          image.backend.repository: "{{.IMAGE_NAME_backend}}"
          image.backend.tag: "{{.IMAGE_TAG_backend}}"
profiles:
  - name: pipeline
    build:
      local:
        push: true
